---
layout: post
title: 'PHP中文按拼音排序'
date: 2016-05-16 16:30:00 +0800
categories: php
---
### 故事的起因

最近项目中有这样一个需求，需要显示一个LOL英雄列表，并且这个列表需要按照英雄中文名字的拼音顺序来排序。比如：

排序前：

> 狂战士 德玛西亚皇子 德玛西亚之力 光辉女郎 寡妇制造者 麦林炮手 

排序后：

> 德玛西亚皇子 德玛西亚之力 寡妇制造者 光辉女郎 狂战士 麦林炮手

那么问题来了，使用PHP怎样实现这个功能呢？

### 故事的经过

1、首先，查看PHP官网手册中的 [数组排序][数组排序] 章节，发现有很多排序函数，这里先使用 [asort][asort] 函数来测试一下：

    $championNames = array('狂战士', '德玛西亚皇子', '德玛西亚之力', '光辉女郎', '寡妇制造者',
            '麦林炮手');
    asort($championNames); 
    echo implode($championNames, " ");
    //输出: 光辉女郎 寡妇制造者 德玛西亚之力 德玛西亚皇子 放逐之刃 狂战士 麦林炮手

* 疑问1：为什么是这个输出结果呢？

* 解答1：asort 函数在这种情况下，会对数组中的字符串进行二进制排序（使用 strcmp ），这里的二进制就是字符串的编码，在这里是 UTF-8。结果就是编码小的字符会在前面，编码大的字符在后面。

* 疑问2：UTF-8 是按照什么顺序编码字符的呢？

* 解答2：UTF-8 是 Unicode 的一种编码实现方式，所以使用的是 Unicode 字符集的字符编码顺序。

* 疑问3：Unicode 是按照什么顺序编码字符的呢？

* 解答3：Unicode 中的汉字是根据《康熙字典》的部首顺序来排序的，部首次序按笔画数排列，同部首字按部首以外的笔画数排列，同笔画数的字以笔形顺序(横、直、撇、点、折)为序。

2、既然直接排序不行，那么是否有其他实现方法呢？

* 方法一：先将中文字符串翻译成拼音字符串，然后再调用 asort 函数；

    > 好处：最直观的实现方式，量少而且固定的时候完全可以通过先手动翻译再排序的方式来保证准确性。

    > 不足：大部分情况下，翻译的质量取决于所用库的质量，库中所包含的汉字拼音映射表有可能不全，而且多音字的翻译是个难题。

* 方法二：先将 UTF-8 编码的字符串翻译成 GBK 编码的字符串，然后再调用 asort 函数；
    
    > 好处：不需要依赖外部的扩展或者库，只需要通过 iconv 函数就可以实现编码转换。

    > 不足：GBK 中的字符并不完全是按照拼音顺序来排序的，所以结果不准确。

* 方法三：使用 PHP 的 intl 扩展的 Collator 类，指定按照拼音顺序排序；

    > 好处：intl 封装了 [ICU][ICU]，ICU 是 International Components for Unicode 的简称，是 Unicode 的国际化组件库。ICU 库提供了
    Unicode Collation 排序功能，而这个排序功能是基于 Unicode 官网提供的排序算法 [UCA][UCA] 和区域特定的比较规则 [CDLR][CDLR]。
    所以，从准确性和权威性来说，应该是相当靠谱的。

    > 不足：需要安装 intl 扩展。而且，因为 intl 依赖于 ICU ，所以还要先安装 ICU 。

### 故事的结局

因为考虑到系统中没有其他模块需要使用类似的功能，而且对排序结果的准确性要求不高，所以，选择使用方法二来实现。


[数组排序]: http://php.net/manual/en/array.sorting.php
[asort]: http://php.net/manual/en/function.asort.php
[ICU]: http://site.icu-project.org/
[UCA]: http://www.unicode.org/reports/tr10/#CLDR
[CDLR]: http://cldr.unicode.org/
